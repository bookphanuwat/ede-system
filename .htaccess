RewriteEngine On
#RewriteBase /

Options +FollowSymLinks +MultiViews

RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f

# if external access force https
RewriteCond %{HTTP_HOST} ^ath7.link [NC]
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

# RewriteRule ^([a-zA-Z-]+)/([0-9]+)(|/)$ index.php?dev=$1&id=$2 [QSA]
RewriteRule ^([0-9a-z-]+)/?$ index.php?dev=$1 [QSA]

<IfModule mod_headers.c>
  Header set X-UA-Compatible "IE=Edge,chrome=1"
  
  # 1. เพิ่มบรรทัดนี้เพื่อป้องกัน Clickjacking (X-Frame-Options)
  Header always set X-Frame-Options "SAMEORIGIN"

  # 2. แก้ไขบรรทัด Content-Security-Policy เดิม โดยเพิ่ม "frame-ancestors 'self';" เข้าไปใน string
# 2. ตั้งค่า CSP ให้รองรับ LINE LIFF (สังเกต connect-src และ img-src)
  Header set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://unpkg.com https://cdn.jsdelivr.net https://static.line-scdn.net; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://fonts.googleapis.com; font-src 'self' https://cdnjs.cloudflare.com https://fonts.gstatic.com; img-src 'self' data: https://api.qrserver.com https://*.line-scdn.net; connect-src 'self' https://*.line.me https://*.line-scdn.net; frame-ancestors 'self'; base-uri 'self'; form-action 'self';"
  # mod_headers can't match by content-type, but we don't want to send this header on *everything*...
  <FilesMatch "\.(appcache|crx|css|eot|gif|htc|ico|jpe?g|js|m4a|m4v|manifest|mp4|oex|oga|ogg|ogv|otf|pdf|png|safariextz|svg|svgz|ttf|vcf|webm|webp|woff|xml|xpi)$">
    Header unset X-UA-Compatible
  </FilesMatch>
</IfModule>
